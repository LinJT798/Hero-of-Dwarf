# 连连看塔防游戏 Demo 功能说明

## 当前完成的功能

### ✅ Phase 1: 项目基础搭建
- **技术栈**: Phaser 3 + TypeScript + Vite
- **项目结构**: 完整的模块化代码结构
- **配置系统**: 简化的配置管理
- **资源管理**: 基础的资源加载和管理

### ✅ Phase 2: 连连看核心功能
- **7×9网格系统**: 完整的连连看网格
- **5种资源类型**: 金币、木头、石头、秘银、食物
- **路径算法**: 经典连连看路径查找（最多3条直线）
- **交互系统**: 点击选择、路径显示、消除动画
- **资源掉落**: 消除后的资源掉落动画

### ✅ Phase 3: 商店和建筑系统
- **资源管理**: 完整的资源收集和管理系统
- **商店系统**: 2栏位随机商品、权重选择、购买验证
- **建筑放置**: 自动从左到右放置建筑
- **建筑管理**: 建筑生命周期管理

### ✅ Phase 4: 矮人NPC系统
- **矮人实体**: 3个矮人NPC自动工作
- **资源收集**: 自动收集掉落的资源
- **任务系统**: 智能任务分配和优先级
- **状态管理**: 多种工作状态和状态显示

### ✅ Phase 5: 塔防战斗系统
- **怪物系统**: 多种怪物类型（基础、强壮、快速）
- **攻击系统**: 弓箭塔自动攻击范围内怪物
- **波次系统**: 3波怪物攻击，逐渐增强
- **战斗特效**: 箭矢飞行和命中特效

### ✅ Phase 6: 关卡和胜负系统
- **城堡血量**: 城堡生命值系统
- **胜利条件**: 成功防守所有波次
- **失败条件**: 城堡血量归零
- **分数系统**: 击杀怪物和完成波次奖励分数
- **游戏结束界面**: 胜利/失败界面和重新开始功能

## 如何测试游戏

### 1. 启动游戏
```bash
npm install
npm run dev
```

### 2. 基本操作
- **连连看**: 点击相同颜色的格子进行消除
- **资源收集**: 消除后资源会自动掉落并添加到资源池
- **购买建筑**: 在商店中点击商品购买建筑

### 3. 测试快捷键
- **R键**: 添加测试资源（木头+5, 石头+3, 金币+2）
- **S键**: 刷新商店
- **D键**: 显示矮人状态信息
- **M键**: 开始下一波怪物攻击
- **V键**: 触发胜利（调试用）
- **B键**: 触发失败（调试用）

### 4. 完整游戏流程
1. **游戏开始**：
   - 上方：连连看网格（7×9）
   - 左侧：商店面板（2个商品栏位）
   - 右上角：资源显示（5种资源的当前数量）
   - 下方：地面区域（建筑和矮人）
   - 左下：城堡血量条

2. **资源收集阶段**：
   - 点击两个相同颜色的方块进行连连看
   - 消除成功后资源掉落
   - 矮人自动收集掉落的资源
   - 资源计数器实时更新

3. **建筑购买**：
   - 按R键添加测试资源（或通过连连看获得）
   - 在商店中点击商品购买弓箭塔
   - 建筑自动从左到右放置

4. **塔防战斗**：
   - 按M键开始怪物波次
   - 怪物从右侧生成，向城堡移动
   - 弓箭塔自动攻击范围内的怪物
   - 观察战斗特效和怪物血量

5. **胜负判定**：
   - 成功防守所有波次即胜利
   - 城堡血量归零即失败
   - 游戏结束后可选择重新开始

## 游戏界面布局

```
┌─────────────────────────────────────────────────────────────────────────────┐
│  [金币:0] [木头:0] [石头:0] [秘银:0] [食物:0]                    [关卡:1] [分数:0] │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  [商店]           [连连看网格 7×9]                                           │
│  ┌─────────┐     ┌─────────────────────────────────────────────────────┐   │
│  │ 弓箭塔  │     │ [金][木][石][银][食][金][木][石][银]                │   │
│  │木头:2   │     │ [食][金][木][石][银][食][金][木][石]                │   │
│  │石头:1   │     │ [银][食][金][木][石][银][食][金][木]                │   │
│  └─────────┘     │ [石][银][食][金][木][石][银][食][金]                │   │
│  ┌─────────┐     │ [木][石][银][食][金][木][石][银][食]                │   │
│  │ 弓箭塔  │     │ [金][木][石][银][食][金][木][石][银]                │   │
│  │木头:3   │     │ [食][金][木][石][银][食][金][木][石]                │   │
│  │石头:2   │     └─────────────────────────────────────────────────────┘   │
│  └─────────┘                                                                │
│                                                                             │
├─────────────────────────────────────────────────────────────────────────────┤
│ [城堡]    [建筑1] [建筑2] [建筑3] [建筑4] [建筑5] [建筑6] [建筑7] [建筑8]      │
│ ▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓ │
└─────────────────────────────────────────────────────────────────────────────┘
```

## 代码结构

```
src/
├── scenes/
│   └── MainGameScene.ts        # 主游戏场景
├── systems/
│   ├── ConfigManager.ts        # 配置管理
│   └── AssetManager.ts         # 资源管理
├── managers/
│   ├── ResourceManager.ts      # 资源管理器
│   └── BuildingManager.ts      # 建筑管理器
├── entities/
│   ├── Match3Cell.ts          # 连连看单元格
│   ├── Match3Grid.ts          # 连连看网格
│   └── Shop.ts                # 商店系统
├── utils/
│   └── PathFinder.ts          # 路径查找算法
└── main.ts                    # 入口文件
```

## 已实现的核心特性

### 连连看系统
- ✅ 7×9网格
- ✅ 5种资源类型
- ✅ 经典路径算法
- ✅ 点击交互
- ✅ 路径显示
- ✅ 消除动画
- ✅ 网格自动刷新

### 资源系统
- ✅ 5种资源管理
- ✅ 资源掉落动画
- ✅ 实时资源显示
- ✅ 资源消费验证

### 商店系统
- ✅ 2栏位显示
- ✅ 随机商品选择
- ✅ 权重分配
- ✅ 购买验证
- ✅ 已购买状态
- ✅ 自动刷新

### 建筑系统
- ✅ 自动建筑放置
- ✅ 建筑生命周期
- ✅ 建筑血量显示
- ✅ 建筑管理器
- ✅ 攻击系统

### 矮人NPC系统
- ✅ 智能任务分配
- ✅ 自动资源收集
- ✅ 状态管理
- ✅ 移动和行为AI

### 战斗系统
- ✅ 多种怪物类型
- ✅ 波次生成系统
- ✅ 塔防攻击逻辑
- ✅ 战斗特效
- ✅ 伤害计算

### 游戏状态系统
- ✅ 城堡血量管理
- ✅ 胜利失败判定
- ✅ 分数系统
- ✅ 游戏重启功能

## 完整游戏体验

这个Demo版本实现了完整的连连看塔防游戏核心玩法：

1. **连连看资源收集**: 通过经典连连看游戏机制收集5种不同资源
2. **智能NPC系统**: 矮人自动收集掉落资源，无需手动操作
3. **策略建筑**: 使用收集的资源购买和放置防御塔
4. **塔防战斗**: 多波次怪物攻击，需要合理部署防御
5. **胜负判定**: 明确的胜利和失败条件，完整的游戏循环

### 游戏特色
- **双重玩法融合**: 连连看 + 塔防的创新组合
- **自动化NPC**: 减少微操，专注策略决策
- **渐进式难度**: 3波怪物逐渐增强挑战性
- **即时反馈**: 丰富的视觉特效和状态显示

## 调试信息

游戏运行时，打开浏览器控制台可以看到：
- 配置加载信息
- 资源变化日志
- 建筑购买日志
- 连连看消除日志
- 路径查找结果

## 技术说明

- **类型安全**: 使用TypeScript确保类型安全
- **模块化**: 清晰的模块划分和职责分离
- **事件驱动**: 使用事件系统解耦模块间依赖
- **配置驱动**: 游戏参数通过配置文件管理
- **简化实现**: 优先实现核心功能，保持代码简洁

---

**开发状态**: Demo版本已完成所有Phase 1-6，包含完整的连连看塔防游戏体验。可以进行完整的游戏流程测试，从资源收集到塔防战斗，再到胜负判定。