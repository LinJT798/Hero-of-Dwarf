# 🎮 连连看塔防游戏 - 玩法模块思维导图

```
🎮 连连看塔防游戏
├── 🎯 核心玩法融合
│   ├── 连连看消除玩法
│   └── 塔防战略玩法
│
├── 📋 1. 连连看资源收集模块
│   ├── 🎲 网格系统
│   │   ├── 7×9网格布局
│   │   ├── 5种资源图案
│   │   │   ├── 金币 💰
│   │   │   ├── 木头 🪵
│   │   │   ├── 石头 🪨
│   │   │   ├── 秘银 ⚡
│   │   │   └── 食物 🍎
│   │   └── 随机生成算法
│   ├── 🎯 消除机制
│   │   ├── 经典连连看规则
│   │   ├── 最多3条直线连接
│   │   ├── 点击选择交互
│   │   └── 路径显示反馈
│   ├── 🎁 资源掉落系统
│   │   ├── 概率掉落机制
│   │   ├── 权重分配系统
│   │   ├── 掉落动画效果
│   │   └── 地面散落分布
│   └── 🔄 自动刷新机制
│       ├── 网格清空检测
│       └── 新布局生成
│
├── 👥 2. 智能NPC系统
│   ├── 🤖 矮人NPC实体
│   │   ├── 3个矮人NPC
│   │   ├── 自动移动AI
│   │   ├── 任务分配系统
│   │   └── 状态机管理
│   ├── 📋 任务优先级系统
│   │   ├── 战斗(4) - 最高优先级
│   │   ├── 建造(3) - 次高优先级
│   │   ├── 交付(2) - 中等优先级
│   │   └── 收集(1) - 最低优先级
│   ├── 🔄 状态机系统
│   │   ├── 战斗状态 (Combat)
│   │   ├── 交付状态 (Deliver)
│   │   ├── 建造状态 (Build)
│   │   ├── 收集状态 (Gather)
│   │   └── 待机状态 (Idle)
│   └── 🧭 智能路径规划
│       ├── 最优路径计算
│       ├── 障碍物避让
│       └── 任务队列管理
│
├── 🏪 3. 商店经济系统
│   ├── 🛒 商店界面
│   │   ├── 2栏位商品显示
│   │   ├── 商品信息展示
│   │   ├── 购买按钮交互
│   │   └── 已购买状态标记
│   ├── 🎲 随机商品系统
│   │   ├── 商品池配置
│   │   ├── 权重随机选择
│   │   ├── 商品刷新机制
│   │   └── 售罄自动刷新
│   ├── 💰 购买验证系统
│   │   ├── 资源充足检查
│   │   ├── 资源扣除机制
│   │   ├── 购买成功反馈
│   │   └── 资源不足提示
│   └── 🏗️ 建筑地基系统
│       ├── 地基创建
│       ├── 位置分配
│       └── 建造通知
│
├── 🏰 4. 塔防战斗系统
│   ├── 🏹 弓箭塔系统
│   │   ├── 自动攻击机制
│   │   ├── 目标选择算法
│   │   ├── 射程范围检测
│   │   └── 攻击速度控制
│   ├── 🎯 攻击表现系统
│   │   ├── 箭矢飞行动画
│   │   ├── 弹道轨迹显示
│   │   ├── 命中效果反馈
│   │   └── 伤害数字显示
│   ├── 🏗️ 建筑管理系统
│   │   ├── 自动放置机制
│   │   ├── 从左到右排序
│   │   ├── 建筑生命值
│   │   └── 建筑摧毁机制
│   └── ⚔️ 战斗计算系统
│       ├── 伤害计算公式
│       ├── 护甲减伤机制
│       ├── 命中判定算法
│       └── 战斗状态更新
│
├── 👹 5. 怪物波次系统
│   ├── 🌊 波次管理
│   │   ├── 3波怪物设计
│   │   ├── 波次时间控制
│   │   ├── 难度递增机制
│   │   └── 波次完成检测
│   ├── 👹 怪物类型
│   │   ├── 基础哥布林
│   │   ├── 强壮哥布林
│   │   └── 快速哥布林
│   ├── 🧠 怪物AI系统
│   │   ├── 移动路径规划
│   │   ├── 目标优先级
│   │   │   ├── 建筑物优先
│   │   │   └── 矮人次之
│   │   ├── 攻击行为逻辑
│   │   └── 死亡处理机制
│   └── 🎭 怪物表现
│       ├── 移动动画
│       ├── 攻击动画
│       ├── 死亡动画
│       └── 血条显示
│
├── 💎 6. 资源经济系统
│   ├── 💰 资源类型管理
│   │   ├── 5种资源类型
│   │   ├── 资源图标显示
│   │   ├── 资源数量统计
│   │   └── 资源UI更新
│   ├── 📦 存储系统
│   │   ├── 无限制存储
│   │   ├── 资源累积机制
│   │   ├── 资源安全性
│   │   └── 持久化保存
│   ├── 🔄 收集机制
│   │   ├── 自动收集触发
│   │   ├── 收集时间控制
│   │   ├── 收集动画效果
│   │   └── 收集队列管理
│   └── 💸 消耗系统
│       ├── 购买验证
│       ├── 资源扣除
│       ├── 消耗反馈
│       └── 余额检查
│
└── 🎯 7. 关卡胜负系统
    ├── 🏆 胜利条件
    │   ├── 所有波次完成
    │   ├── 城堡安全保护
    │   ├── 怪物全部消灭
    │   └── 胜利界面显示
    ├── 💀 失败条件
    │   ├── 城堡被攻破
    │   ├── 即时失败判定
    │   ├── 失败界面显示
    │   └── 重试选项提供
    ├── 📊 分数系统
    │   ├── 击杀怪物得分
    │   ├── 波次完成奖励
    │   ├── 分数累计统计
    │   └── 分数显示更新
    └── 🔄 游戏重启
        ├── 状态完全重置
        ├── 配置重新加载
        ├── 资源清理机制
        └── 重新开始功能
```

## 🔄 玩法模块关系图

```
连连看模块 ──┐
             ├── 资源掉落 ──→ 矮人收集 ──→ 资源存储
             └── 消除反馈 ──→ 视觉特效

商店系统 ←── 资源存储 ──→ 建筑购买 ──→ 建筑建造

建筑建造 ──→ 塔防系统 ──→ 怪物攻击 ──→ 战斗计算

怪物系统 ──→ 波次管理 ──→ 胜负判定 ──→ 游戏重启
```

## 🎯 核心游戏循环

```
1. 连连看消除 → 2. 资源掉落 → 3. 矮人收集 → 
4. 资源存储 → 5. 商店购买 → 6. 建筑建造 → 
7. 塔防战斗 → 8. 怪物防守 → 9. 胜负判定 → 
10. 游戏重启
```

## 🏆 游戏玩法特色

- **🎮 双重玩法融合**：消除 + 塔防的创新组合
- **🤖 智能NPC系统**：减少微操，专注策略
- **🔄 完整游戏循环**：从收集到战斗的完整体验
- **📈 渐进式挑战**：3波怪物逐渐增强难度
- **🎨 丰富视觉反馈**：动画、特效、UI的完整表现 