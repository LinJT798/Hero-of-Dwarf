# 资源经济系统需求文档

## 模块概述

资源经济系统管理游戏中的资源流转，包括资源掉落、收集、存储和消耗等核心功能。

## 1. 基础设定

### 资源类型
游戏包含5种资源类型：
1. **金币**
2. **木头**
3. **石头**
4. **秘银**
5. **食物**

### 资源来源
- **主要来源**：连连看消除掉落
- **掉落机制**：按照连连看模块的概率和权重系统
- **掉落位置**：从连连看区域掉落到地面区域

## 2. 资源存储系统

### 存储机制
- **存储上限**：无限制
- **存储位置**：玩家库存（数据结构）
- **持久性**：单局游戏内永久保存
- **过期机制**：资源不会过期或消失

### 存储特点
- **累积性**：资源可以无限累积
- **安全性**：收集后的资源不会丢失
- **可配置性**：如需要可通过配置文件调整上限

## 3. 资源转换系统

### 当前版本限制
- **不支持资源间转换**：无法将一种资源转换为另一种
- **不支持资源兑换**：无资源兑换比例或机制
- **无基础价值概念**：资源之间没有价值换算关系

### 未来扩展
- **保留扩展性**：系统架构支持后续添加转换功能
- **配置驱动**：通过配置文件可以开启转换功能

## 4. 矮人收集机制

### 收集行为
- **移动方式**：矮人NPC在地面移动到资源位置
- **移动速度**：可配置的移动速度参数
- **收集时间**：到达资源位置后花费固定时间收集

### 收集优先级
- **优先策略**：优先收集最早掉落的资源
- **排队机制**：按掉落时间顺序排列收集队列
- **路径规划**：矮人会规划最优路径依次收集

### 收集流程
1. 资源从连连看区域掉落到地面
2. 矮人检测到新的资源掉落
3. 将资源添加到收集队列（按时间排序）
4. 矮人移动到最早掉落资源的位置
5. 到达后花费x秒时间收集资源
6. 资源添加到玩家库存
7. 继续收集队列中的下一个资源

## 5. 资源消耗系统

### 消耗用途
- **建筑建造**：用于购买和建造弓箭塔
- **消耗方式**：在商店中购买建筑物时扣除对应资源

### 消耗机制
- **即时扣除**：购买建筑物时立即扣除相应资源
- **不可逆性**：消耗的资源无法回收
- **需求检查**：购买前检查资源是否足够

## 6. 资源显示系统

### 显示界面
- **显示位置**：游戏界面中的固定UI区域
- **显示内容**：当前拥有的各种资源数量
- **显示格式**：图标 + 数字的形式

### 显示特点
- **实时更新**：资源数量变化时UI同步更新
- **无变化提示**：不需要资源变化的动画或提示
- **简洁明了**：清晰显示当前资源状态

## 7. 经济平衡设计

### 平衡原则
- **完全配置驱动**：所有数值通过配置文件调整
- **灵活调节**：可根据测试结果调整各项参数
- **无预设平衡**：不考虑预设的经济平衡，完全由配置决定

### 可配置参数
- **建筑成本**：各类建筑所需的资源数量
- **掉落概率**：各种资源的掉落权重
- **收集速度**：矮人移动和收集的时间参数

## 8. 配置文件设计

### 资源配置 (resource_config.json)
```json
{
  "resources": {
    "gold": {
      "name": "金币",
      "icon": "gold_icon.png",
      "drop_weight": 30
    },
    "wood": {
      "name": "木头",
      "icon": "wood_icon.png",
      "drop_weight": 25
    },
    "stone": {
      "name": "石头",
      "icon": "stone_icon.png",
      "drop_weight": 25
    },
    "mithril": {
      "name": "秘银",
      "icon": "mithril_icon.png",
      "drop_weight": 15
    },
    "food": {
      "name": "食物",
      "icon": "food_icon.png",
      "drop_weight": 20
    }
  },
  "collection": {
    "dwarf_move_speed": 100,
    "collection_time": 1.0,
    "ground_resource_lifetime": -1
  }
}
```

### 建筑成本配置 (building_cost_config.json)
```json
{
  "arrow_tower": {
    "cost": {
      "wood": 2,
      "stone": 1,
      "gold": 1
    }
  }
}
```

## 9. 技术要求

### 核心功能
- **资源管理**：资源的增减和状态管理
- **收集队列**：矮人收集任务的队列管理
- **UI同步**：资源数量与界面显示的同步
- **配置加载**：配置文件的读取和应用

### 数据结构
```javascript
// 玩家资源
PlayerResources = {
  gold: 0,
  wood: 0,
  stone: 0,
  mithril: 0,
  food: 0
}

// 地面资源
GroundResource = {
  type: "resource_type",
  position: {x, y},
  drop_time: timestamp,
  collected: false
}

// 收集队列
CollectionQueue = [
  {resource_id, priority, drop_time}
]
```

### 性能要求
- **高效收集**：矮人路径规划的性能优化
- **内存管理**：地面资源对象的及时回收
- **UI响应**：资源数量更新的及时性

## 10. 测试要点

### 功能测试
- 资源掉落的正确性
- 矮人收集的准确性
- 资源消耗的正确性
- 配置文件的有效性

### 性能测试
- 大量资源掉落时的性能
- 矮人路径规划的效率
- UI更新的流畅性

### 用户体验测试
- 资源收集的视觉反馈
- 收集优先级的合理性
- 资源显示的清晰性

---

*文档创建时间：2025年7月8日*
*最后更新时间：2025年7月8日*